<tool id="proteomics_search_tandem_1" name="X!Tandem MSMS Search" version="1.0.0">
	<requirements><requirement type="package">protk</requirement></requirements>
	<description>Run an X!Tandem Search</description>

	<command>
		#if $database.source_select=="built_in":
		tandem_search.rb -d $database.dbkey 
		#else #tandem_search.rb -d $database.fasta_file
		#end if

		$input_file -o $output -r --enzyme=$enzyme --precursor-ion-tol-units=$precursor_tolu -v $missed_cleavages -f $fragment_ion_tol -p $precursor_ion_tol --num-peaks-for-multi-isotope-search $multi_isotope $use_average_mass --keep-params-files
		
		
		
	</command>

	<inputs>	
		<conditional name="database">
			<param name="source_select" type="select" label="Database source">
				<option value="built_in">Built-In</option>
				<option value="input_ref">Your Upload File</option>
			</param>
			<when value="built_in">
				<param name="dbkey" type="select" format="text" >
					<label>Database</label>
					<options from_file="pepxml_databases.loc">
						<column name="name" index="0" />
						<column name="value" index="2" />
					</options>
				</param>
			</when>
			<when value="input_ref">
				<param name="fasta_file" type="data" format="fasta" label="Uploaded FASTA file" />
			</when>
		</conditional>
		
		<param name="input_file" type="data" format="mzml" multiple="false" label="MSMS File" help="An mzML file with MS/MS data"/>

		<param name="missed_cleavages" type="select" format="text" help="Allow peptides to contain up to this many missed enzyme cleavage sites">
			<label>Missed Cleavages Allowed</label>
		    <option value="0">0</option>		
			<option value="1">1</option>
			<option value="2">2</option>
		</param>
		
		<param name="enzyme" type="select" format="text">
		    <label>Enzyme</label>
		    <option value="Trypsin">Trypsin</option>
		</param>
		
		<param name="fragment_ion_tol" help="Fragment Ion Tolerance in Daltons" type="float" value="0.65" min="0" max="10000" label="Fragment ion tolerance"/>

		<param name="precursor_ion_tol" help="Precursor Ion Tolerance (Da or ppm)" type="float" value="100" min="0" max="10000" label="Precursor ion tolerance"/>
		<param name="precursor_tolu" type="select" format="text">
		    <label>Precursor Ion Tolerance Units</label>
		    <option value="ppm">ppm</option>		
			<option value="Da">Da</option>
		</param>
		
		<param name="use_average_mass" type="boolean" label="Use average precursor masses" help="Match precursor to average mass of the parent ion instead of its monoisotopic mass" truevalue="-a average" falsevalue=""/>
		
		<param name="multi_isotope" type="select" format="text" help="Include this many neighbouring peaks when searching for a match to the precursor mass. Only used when doing monoisotopic search">
			<label>Multi-isotope search.</label>
		    <option value="0">0</option>
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
		</param>

	</inputs>


	<outputs>
		<data format="raw_pepxml" name="output" metadata_source="input_file" label="X!Tandem_vs_${database.dbkey if $database.has_key('dbkey') else $database.fasta_file.display_name}.${input_file.display_name}.${input_file.display_name}.pepXML"/>
	</outputs>


  <help>
	Run an X!Tandem Search
  </help>

</tool>
